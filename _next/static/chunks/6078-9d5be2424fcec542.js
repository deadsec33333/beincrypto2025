"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6078],{86078:function(e,t,i){var n=i(26365),r=i(31686),a=i(6989),s=i(83145),l=i(41154),o=i(25049),u=i(76405),d=i(11993),c=i(23789),h=i(32559),g=i(2265),f=i(91695),v=i(11702),F=i(53155),p=i(82098),Z=i(21315),m=["name"],V=(0,o.Z)(function e(t){var i=this;(0,u.Z)(this,e),(0,d.Z)(this,"formHooked",!1),(0,d.Z)(this,"forceRootUpdate",void 0),(0,d.Z)(this,"subscribable",!0),(0,d.Z)(this,"store",{}),(0,d.Z)(this,"fieldEntities",[]),(0,d.Z)(this,"initialValues",{}),(0,d.Z)(this,"callbacks",{}),(0,d.Z)(this,"validateMessages",null),(0,d.Z)(this,"preserve",null),(0,d.Z)(this,"lastValidatePromise",null),(0,d.Z)(this,"getForm",function(){return{getFieldValue:i.getFieldValue,getFieldsValue:i.getFieldsValue,getFieldError:i.getFieldError,getFieldWarning:i.getFieldWarning,getFieldsError:i.getFieldsError,isFieldsTouched:i.isFieldsTouched,isFieldTouched:i.isFieldTouched,isFieldValidating:i.isFieldValidating,isFieldsValidating:i.isFieldsValidating,resetFields:i.resetFields,setFields:i.setFields,setFieldValue:i.setFieldValue,setFieldsValue:i.setFieldsValue,validateFields:i.validateFields,submit:i.submit,_init:!0,getInternalHooks:i.getInternalHooks}}),(0,d.Z)(this,"getInternalHooks",function(e){return e===f.k?(i.formHooked=!0,{dispatch:i.dispatch,initEntityValue:i.initEntityValue,registerField:i.registerField,useSubscribe:i.useSubscribe,setInitialValues:i.setInitialValues,destroyForm:i.destroyForm,setCallbacks:i.setCallbacks,setValidateMessages:i.setValidateMessages,getFields:i.getFields,setPreserve:i.setPreserve,getInitialValue:i.getInitialValue,registerWatch:i.registerWatch}):((0,h.ZP)(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)}),(0,d.Z)(this,"useSubscribe",function(e){i.subscribable=e}),(0,d.Z)(this,"prevWithoutPreserves",null),(0,d.Z)(this,"setInitialValues",function(e,t){if(i.initialValues=e||{},t){var n,r=(0,c.T)(e,i.store);null===(n=i.prevWithoutPreserves)||void 0===n||n.map(function(t){var i=t.key;r=(0,Z.sO)(r,i,(0,Z.NA)(e,i))}),i.prevWithoutPreserves=null,i.updateStore(r)}}),(0,d.Z)(this,"destroyForm",function(e){if(e)i.updateStore({});else{var t=new p.Z;i.getFieldEntities(!0).forEach(function(e){i.isMergedPreserve(e.isPreserve())||t.set(e.getNamePath(),!0)}),i.prevWithoutPreserves=t}}),(0,d.Z)(this,"getInitialValue",function(e){var t=(0,Z.NA)(i.initialValues,e);return e.length?(0,c.T)(t):t}),(0,d.Z)(this,"setCallbacks",function(e){i.callbacks=e}),(0,d.Z)(this,"setValidateMessages",function(e){i.validateMessages=e}),(0,d.Z)(this,"setPreserve",function(e){i.preserve=e}),(0,d.Z)(this,"watchList",[]),(0,d.Z)(this,"registerWatch",function(e){return i.watchList.push(e),function(){i.watchList=i.watchList.filter(function(t){return t!==e})}}),(0,d.Z)(this,"notifyWatch",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(i.watchList.length){var t=i.getFieldsValue(),n=i.getFieldsValue(!0);i.watchList.forEach(function(i){i(t,n,e)})}}),(0,d.Z)(this,"timeoutId",null),(0,d.Z)(this,"warningUnhooked",function(){}),(0,d.Z)(this,"updateStore",function(e){i.store=e}),(0,d.Z)(this,"getFieldEntities",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?i.fieldEntities.filter(function(e){return e.getNamePath().length}):i.fieldEntities}),(0,d.Z)(this,"getFieldsMap",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new p.Z;return i.getFieldEntities(e).forEach(function(e){var i=e.getNamePath();t.set(i,e)}),t}),(0,d.Z)(this,"getFieldEntitiesForNamePathList",function(e){if(!e)return i.getFieldEntities(!0);var t=i.getFieldsMap(!0);return e.map(function(e){var i=(0,Z.gU)(e);return t.get(i)||{INVALIDATE_NAME_PATH:(0,Z.gU)(e)}})}),(0,d.Z)(this,"getFieldsValue",function(e,t){if(i.warningUnhooked(),!0===e||Array.isArray(e)?(n=e,r=t):e&&"object"===(0,l.Z)(e)&&(a=e.strict,r=e.filter),!0===n&&!r)return i.store;var n,r,a,s=i.getFieldEntitiesForNamePathList(Array.isArray(n)?n:null),o=[];return s.forEach(function(e){var t,i,s,l="INVALIDATE_NAME_PATH"in e?e.INVALIDATE_NAME_PATH:e.getNamePath();if(a){if(null!==(s=e.isList)&&void 0!==s&&s.call(e))return}else if(!n&&null!==(t=(i=e).isListField)&&void 0!==t&&t.call(i))return;if(r){var u="getMeta"in e?e.getMeta():null;r(u)&&o.push(l)}else o.push(l)}),(0,Z.H_)(i.store,o.map(Z.gU))}),(0,d.Z)(this,"getFieldValue",function(e){i.warningUnhooked();var t=(0,Z.gU)(e);return(0,Z.NA)(i.store,t)}),(0,d.Z)(this,"getFieldsError",function(e){return i.warningUnhooked(),i.getFieldEntitiesForNamePathList(e).map(function(t,i){return!t||"INVALIDATE_NAME_PATH"in t?{name:(0,Z.gU)(e[i]),errors:[],warnings:[]}:{name:t.getNamePath(),errors:t.getErrors(),warnings:t.getWarnings()}})}),(0,d.Z)(this,"getFieldError",function(e){i.warningUnhooked();var t=(0,Z.gU)(e);return i.getFieldsError([t])[0].errors}),(0,d.Z)(this,"getFieldWarning",function(e){i.warningUnhooked();var t=(0,Z.gU)(e);return i.getFieldsError([t])[0].warnings}),(0,d.Z)(this,"isFieldsTouched",function(){i.warningUnhooked();for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=n[0],l=n[1],o=!1;0===n.length?e=null:1===n.length?Array.isArray(a)?(e=a.map(Z.gU),o=!1):(e=null,o=a):(e=a.map(Z.gU),o=l);var u=i.getFieldEntities(!0),d=function(e){return e.isFieldTouched()};if(!e)return o?u.every(function(e){return d(e)||e.isList()}):u.some(d);var c=new p.Z;e.forEach(function(e){c.set(e,[])}),u.forEach(function(t){var i=t.getNamePath();e.forEach(function(e){e.every(function(e,t){return i[t]===e})&&c.update(e,function(e){return[].concat((0,s.Z)(e),[t])})})});var h=function(e){return e.some(d)},g=c.map(function(e){return e.value});return o?g.every(h):g.some(h)}),(0,d.Z)(this,"isFieldTouched",function(e){return i.warningUnhooked(),i.isFieldsTouched([e])}),(0,d.Z)(this,"isFieldsValidating",function(e){i.warningUnhooked();var t=i.getFieldEntities();if(!e)return t.some(function(e){return e.isFieldValidating()});var n=e.map(Z.gU);return t.some(function(e){var t=e.getNamePath();return(0,Z.T1)(n,t)&&e.isFieldValidating()})}),(0,d.Z)(this,"isFieldValidating",function(e){return i.warningUnhooked(),i.isFieldsValidating([e])}),(0,d.Z)(this,"resetWithFieldInitialValue",function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=new p.Z,r=i.getFieldEntities(!0);r.forEach(function(e){var t=e.props.initialValue,i=e.getNamePath();if(void 0!==t){var r=n.get(i)||new Set;r.add({entity:e,value:t}),n.set(i,r)}}),t.entities?e=t.entities:t.namePathList?(e=[],t.namePathList.forEach(function(t){var i,r=n.get(t);r&&(i=e).push.apply(i,(0,s.Z)((0,s.Z)(r).map(function(e){return e.entity})))})):e=r,function(e){e.forEach(function(e){if(void 0!==e.props.initialValue){var r=e.getNamePath();if(void 0!==i.getInitialValue(r))(0,h.ZP)(!1,"Form already set 'initialValues' with path '".concat(r.join("."),"'. Field can not overwrite it."));else{var a=n.get(r);if(a&&a.size>1)(0,h.ZP)(!1,"Multiple Field with path '".concat(r.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(a){var l=i.getFieldValue(r);e.isListField()||t.skipExist&&void 0!==l||i.updateStore((0,Z.sO)(i.store,r,(0,s.Z)(a)[0].value))}}}})}(e)}),(0,d.Z)(this,"resetFields",function(e){i.warningUnhooked();var t=i.store;if(!e){i.updateStore((0,c.T)(i.initialValues)),i.resetWithFieldInitialValue(),i.notifyObservers(t,null,{type:"reset"}),i.notifyWatch();return}var n=e.map(Z.gU);n.forEach(function(e){var t=i.getInitialValue(e);i.updateStore((0,Z.sO)(i.store,e,t))}),i.resetWithFieldInitialValue({namePathList:n}),i.notifyObservers(t,n,{type:"reset"}),i.notifyWatch(n)}),(0,d.Z)(this,"setFields",function(e){i.warningUnhooked();var t=i.store,n=[];e.forEach(function(e){var r=e.name,s=(0,a.Z)(e,m),l=(0,Z.gU)(r);n.push(l),"value"in s&&i.updateStore((0,Z.sO)(i.store,l,s.value)),i.notifyObservers(t,[l],{type:"setField",data:e})}),i.notifyWatch(n)}),(0,d.Z)(this,"getFields",function(){return i.getFieldEntities(!0).map(function(e){var t=e.getNamePath(),n=e.getMeta(),a=(0,r.Z)((0,r.Z)({},n),{},{name:t,value:i.getFieldValue(t)});return Object.defineProperty(a,"originRCField",{value:!0}),a})}),(0,d.Z)(this,"initEntityValue",function(e){var t=e.props.initialValue;if(void 0!==t){var n=e.getNamePath();void 0===(0,Z.NA)(i.store,n)&&i.updateStore((0,Z.sO)(i.store,n,t))}}),(0,d.Z)(this,"isMergedPreserve",function(e){var t=void 0!==e?e:i.preserve;return null==t||t}),(0,d.Z)(this,"registerField",function(e){i.fieldEntities.push(e);var t=e.getNamePath();if(i.notifyWatch([t]),void 0!==e.props.initialValue){var n=i.store;i.resetWithFieldInitialValue({entities:[e],skipExist:!0}),i.notifyObservers(n,[e.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(i.fieldEntities=i.fieldEntities.filter(function(t){return t!==e}),!i.isMergedPreserve(r)&&(!n||a.length>1)){var s=n?void 0:i.getInitialValue(t);if(t.length&&i.getFieldValue(t)!==s&&i.fieldEntities.every(function(e){return!(0,Z.LX)(e.getNamePath(),t)})){var l=i.store;i.updateStore((0,Z.sO)(l,t,s,!0)),i.notifyObservers(l,[t],{type:"remove"}),i.triggerDependenciesUpdate(l,t)}}i.notifyWatch([t])}}),(0,d.Z)(this,"dispatch",function(e){switch(e.type){case"updateValue":var t=e.namePath,n=e.value;i.updateValue(t,n);break;case"validateField":var r=e.namePath,a=e.triggerName;i.validateFields([r],{triggerName:a})}}),(0,d.Z)(this,"notifyObservers",function(e,t,n){if(i.subscribable){var a=(0,r.Z)((0,r.Z)({},n),{},{store:i.getFieldsValue(!0)});i.getFieldEntities().forEach(function(i){(0,i.onStoreChange)(e,t,a)})}else i.forceRootUpdate()}),(0,d.Z)(this,"triggerDependenciesUpdate",function(e,t){var n=i.getDependencyChildrenFields(t);return n.length&&i.validateFields(n),i.notifyObservers(e,n,{type:"dependenciesUpdate",relatedFields:[t].concat((0,s.Z)(n))}),n}),(0,d.Z)(this,"updateValue",function(e,t){var n=(0,Z.gU)(e),r=i.store;i.updateStore((0,Z.sO)(i.store,n,t)),i.notifyObservers(r,[n],{type:"valueUpdate",source:"internal"}),i.notifyWatch([n]);var a=i.triggerDependenciesUpdate(r,n),l=i.callbacks.onValuesChange;l&&l((0,Z.H_)(i.store,[n]),i.getFieldsValue()),i.triggerOnFieldsChange([n].concat((0,s.Z)(a)))}),(0,d.Z)(this,"setFieldsValue",function(e){i.warningUnhooked();var t=i.store;if(e){var n=(0,c.T)(i.store,e);i.updateStore(n)}i.notifyObservers(t,null,{type:"valueUpdate",source:"external"}),i.notifyWatch()}),(0,d.Z)(this,"setFieldValue",function(e,t){i.setFields([{name:e,value:t,errors:[],warnings:[]}])}),(0,d.Z)(this,"getDependencyChildrenFields",function(e){var t=new Set,n=[],r=new p.Z;return i.getFieldEntities().forEach(function(e){(e.props.dependencies||[]).forEach(function(t){var i=(0,Z.gU)(t);r.update(i,function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set;return t.add(e),t})})}),function e(i){(r.get(i)||new Set).forEach(function(i){if(!t.has(i)){t.add(i);var r=i.getNamePath();i.isFieldDirty()&&r.length&&(n.push(r),e(r))}})}(e),n}),(0,d.Z)(this,"triggerOnFieldsChange",function(e,t){var n=i.callbacks.onFieldsChange;if(n){var r=i.getFields();if(t){var a=new p.Z;t.forEach(function(e){var t=e.name,i=e.errors;a.set(t,i)}),r.forEach(function(e){e.errors=a.get(e.name)||e.errors})}var s=r.filter(function(t){var i=t.name;return(0,Z.T1)(e,i)});s.length&&n(s,r)}}),(0,d.Z)(this,"validateFields",function(e,t){i.warningUnhooked(),Array.isArray(e)||"string"==typeof e||"string"==typeof t?(n=e,a=t):a=e;var n,a,l=!!n,o=l?n.map(Z.gU):[],u=[],d=String(Date.now()),c=new Set,h=a||{},g=h.recursive,f=h.dirty;i.getFieldEntities(!0).forEach(function(e){if(l||o.push(e.getNamePath()),e.props.rules&&e.props.rules.length&&(!f||e.isFieldDirty())){var t=e.getNamePath();if(c.add(t.join(d)),!l||(0,Z.T1)(o,t,g)){var n=e.validateRules((0,r.Z)({validateMessages:(0,r.Z)((0,r.Z)({},F.y),i.validateMessages)},a));u.push(n.then(function(){return{name:t,errors:[],warnings:[]}}).catch(function(e){var i,n=[],r=[];return(null===(i=e.forEach)||void 0===i||i.call(e,function(e){var t=e.rule.warningOnly,i=e.errors;t?r.push.apply(r,(0,s.Z)(i)):n.push.apply(n,(0,s.Z)(i))}),n.length)?Promise.reject({name:t,errors:n,warnings:r}):{name:t,errors:n,warnings:r}}))}}});var p=(0,v.v)(u);i.lastValidatePromise=p,p.catch(function(e){return e}).then(function(e){var t=e.map(function(e){return e.name});i.notifyObservers(i.store,t,{type:"validateFinish"}),i.triggerOnFieldsChange(t,e)});var m=p.then(function(){return i.lastValidatePromise===p?Promise.resolve(i.getFieldsValue(o)):Promise.reject([])}).catch(function(e){var t=e.filter(function(e){return e&&e.errors.length});return Promise.reject({values:i.getFieldsValue(o),errorFields:t,outOfDate:i.lastValidatePromise!==p})});m.catch(function(e){return e});var V=o.filter(function(e){return c.has(e.join(d))});return i.triggerOnFieldsChange(V),m}),(0,d.Z)(this,"submit",function(){i.warningUnhooked(),i.validateFields().then(function(e){var t=i.callbacks.onFinish;if(t)try{t(e)}catch(e){console.error(e)}}).catch(function(e){var t=i.callbacks.onFinishFailed;t&&t(e)})}),this.forceRootUpdate=t});t.Z=function(e){var t=g.useRef(),i=g.useState({}),r=(0,n.Z)(i,2)[1];if(!t.current){if(e)t.current=e;else{var a=new V(function(){r({})});t.current=a.getForm()}}return[t.current]}}}]);